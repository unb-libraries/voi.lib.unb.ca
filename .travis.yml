language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - echo "$DOCKER_CLOUD_USER_PASS" | docker login --username "$DOCKER_CLOUD_USER_NAME" --password-stdin
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH
  - vendor/unb-libraries/dockworker/scripts/travis/notifyNewRelicDeployment.sh

notifications:
  slack:
    rooms:
      secure: tc4slq4Rdo4ylwWqk6SFE6JMtRIAEcJJr+darroeA74JkL9NWKPgCb9QKO8xjiPf1RE/pX0ouKRRvSKSLZmXR77skVMeD4tutrl7n0zotNqEC3jzTAYmYNPusFhJPfQDs31Tf2QhryAY2IQUIoKuF7ghhKSGJwj+3IN0xYp5nOZJtkbv6d5yLMdeW7DrldnRm0JZ6Z5/Sf6Wl2hLruLGJcnzIzdElH1qII9u1y46zu1S1PT0u+y2i6PvbdkMaxVQcScP9QR/Hq4dNDK299QR47K2lgeRovvRrs9CFhzdL1UDIItFDuZXDMPj/MnkKqUWTLoK4AzsQJdsghGgmtB5TqTQH4mdqPrqCqIcDSvVFVoAsuTrYO1V0YIBbnaVRSGpete7ofI/dyAQ5CdKrEhk9aP/fFrE13fv4dLsSENZPK2L6rUE63Lq4lYkHencL5EHaUpp88RvTZHT6yZZO9ITPXyJ1UiueimFhQcloixPV9Y8ywxn31vYA7I2IWhHsz8qyp5KZIsJ+duWXwta3gx+SXqjrggpFNX28ZxY7BEKWH39VbcfjuHHdOEjryEl9UecpeAlBq5/CcRwBkUQzSet6UmXWx0pv8s2DtqqAXAiq0lRAOS/usjYayTzTdIXoIC4s0ghwawSb7mDU2XAvf68Vh3rXr2f6JCnSUixwxb6I8c=
    on_start: always
    on_success: always
